<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>नेपालको संविधान - नेपाल कानून</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #d32f2f;
            --primary-dark: #b71c1c;
            --bg-dark: #121212;
            --surface-dark: #1e1e1e;
            --text-dark: #e0e0e0;
            --bg-light: #f8f9fa;
            --surface-light: #ffffff;
            --text-light: #212121;
            --font-size: 16px;
            --transition-speed: 0.3s;
        }

        body {
            margin: 0;
            font-family: 'Noto Sans Devanagari', 'Roboto', sans-serif;
            transition: background var(--transition-speed), color var(--transition-speed);
            overflow-x: hidden;
            font-size: var(--font-size);
            -webkit-tap-highlight-color: transparent;
        }

        body[data-theme="dark"] { 
            background-color: var(--bg-dark); 
            color: var(--text-dark); 
        }
        body[data-theme="light"] { 
            background-color: var(--bg-light); 
            color: var(--text-light); 
        }

        /* Modern App Bar */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 0 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            background: var(--primary);
            color: white;
            height: 60px;
            box-sizing: border-box;
        }

        .header-title { 
            font-size: 1.1rem; 
            font-weight: 700; 
            margin: 0; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis;
            transition: all 0.3s ease;
        }

        .header-actions { 
            display: flex; 
            gap: 8px; 
        }
        
        .header-btn { 
            background: none; 
            border: none; 
            color: white; 
            font-size: 1.2rem; 
            cursor: pointer; 
            padding: 8px;
            border-radius: 50%;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .header-btn:active { 
            background: rgba(255,255,255,0.2); 
        }

        /* Hero Section Animation */
        .hero-section {
            padding: 40px 20px;
            text-align: center;
            background: linear-gradient(rgba(0,0,0,0.75), rgba(0,0,0,0.75)), url('https://upload.wikimedia.org/wikipedia/commons/2/23/Emblem_of_Nepal.svg');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            color: white;
            animation: heroZoom 20s infinite alternate linear;
        }
        
        @keyframes heroZoom {
            from { background-size: 50%; }
            to { background-size: 60%; }
        }

        /* Animated List Items */
        .recycler-view { 
            padding: 12px; 
            display: flex; 
            flex-direction: column; 
            gap: 12px; 
            max-width: 800px;
            margin: 0 auto;
        }

        .law-item {
            padding: 16px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
            opacity: 0;
            transform: translateY(20px);
        }

        .law-item.animate-in {
            animation: fadeInUp 0.4s forwards ease-out;
        }

        @keyframes fadeInUp {
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        body[data-theme="dark"] .law-item { 
            background: var(--surface-dark); 
            border: 1px solid rgba(255,255,255,0.05); 
        }
        
        body[data-theme="light"] .law-item { 
            background: var(--surface-light); 
            border: 1px solid rgba(0,0,0,0.05); 
        }

        .law-item:active { 
            transform: scale(0.97); 
        }

        .item-icon {
            min-width: 44px; 
            height: 44px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 14px;
            display: flex;
            align-items: center; 
            justify-content: center;
            color: white; 
            font-weight: bold;
            font-size: 0.9rem;
            box-shadow: 0 4px 8px rgba(211, 47, 47, 0.3);
        }

        .item-info h3 { 
            margin: 0; 
            font-size: 1rem; 
            line-height: 1.4; 
            font-weight: 500; 
        }

        /* Disclaimer Modal Styles */
        .disclaimer-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(10px);
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .disclaimer-modal.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .disclaimer-content {
            background: linear-gradient(145deg, #1a1a1a, #2d1b1b);
            border-radius: 24px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            border: 2px solid var(--primary);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
            transform: translateY(0);
            transition: transform 0.3s ease;
        }

        .disclaimer-modal.hidden .disclaimer-content {
            transform: translateY(50px);
        }

        .disclaimer-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .disclaimer-content h2 {
            color: var(--primary);
            margin: 0 0 20px 0;
            font-size: 1.5rem;
            border-bottom: 2px solid rgba(211, 47, 47, 0.3);
            padding-bottom: 10px;
        }

        .disclaimer-text {
            text-align: left;
            margin-bottom: 25px;
            max-height: 50vh;
            overflow-y: auto;
            padding-right: 10px;
            color: #ffffff;
        }

        .disclaimer-text p {
            margin: 15px 0;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .disclaimer-text p strong {
            color: #ffcc00;
            display: block;
            margin-bottom: 5px;
        }

        .disclaimer-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 0 auto;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(211, 47, 47, 0.4);
            min-width: 200px;
        }

        .disclaimer-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(211, 47, 47, 0.6);
        }

        .disclaimer-btn:active {
            transform: translateY(0);
        }

        /* Scrollbar styling for disclaimer text */
        .disclaimer-text::-webkit-scrollbar {
            width: 6px;
        }

        .disclaimer-text::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .disclaimer-text::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        /* Screen Transitions */
        .screen { 
            display: none; 
            padding-bottom: 60px; 
        }
        
        .screen.active { 
            display: block; 
            animation: fadeInScale 0.3s ease-out;
        }

        @keyframes fadeInScale {
            from { 
                opacity: 0; 
                transform: scale(0.98); 
            }
            to { 
                opacity: 1; 
                transform: scale(1); 
            }
        }

        /* Detail Content Cards */
        .content-card {
            margin: 16px; 
            padding: 20px;
            border-radius: 16px; 
            line-height: 1.7;
            position: relative;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-left: 4px solid var(--primary);
        }
        
        body[data-theme="dark"] .content-card { 
            background: var(--surface-dark); 
        }
        
        body[data-theme="light"] .content-card { 
            background: var(--surface-light); 
        }

        .card-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start; 
            margin-bottom: 12px; 
            gap: 10px; 
        }
        
        .bookmark-icon { 
            cursor: pointer; 
            color: var(--primary); 
            font-size: 1.4rem; 
            padding: 4px;
            transition: transform 0.2s;
        }
        
        .bookmark-icon:active { 
            transform: scale(1.3); 
        }

        /* Floating Settings Button UI */
        .settings-overlay {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0,0,0,0.6); 
            z-index: 200;
            display: none; 
            align-items: flex-end;
            backdrop-filter: blur(4px);
        }
        
        .settings-panel {
            width: 100%; 
            background: var(--surface-light);
            border-radius: 24px 24px 0 0; 
            padding: 28px;
            box-sizing: border-box; 
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .settings-overlay.open .settings-panel { 
            transform: translateY(0); 
        }
        
        body[data-theme="dark"] .settings-panel { 
            background: #222; 
            color: white; 
        }

        .settings-section { 
            margin-bottom: 24px; 
        }
        
        .settings-section h4 { 
            margin: 0 0 12px 0; 
            font-size: 0.85rem; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            color: var(--primary); 
        }
        
        .flex-row { 
            display: flex; 
            gap: 12px; 
            flex-wrap: wrap; 
        }
        
        .btn { 
            padding: 12px 24px; 
            border-radius: 12px; 
            border: 2px solid var(--primary); 
            background: none; 
            color: var(--primary); 
            cursor: pointer; 
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn.active { 
            background: var(--primary); 
            color: white; 
            box-shadow: 0 4px 10px rgba(211, 47, 47, 0.3); 
        }

        .font-slider { 
            width: 100%; 
            accent-color: var(--primary); 
            margin: 15px 0; 
            height: 6px; 
            border-radius: 3px; 
        }

        /* Search Bar Enhancement */
        .search-container { 
            padding: 16px; 
            position: sticky; 
            top: 60px; 
            background: inherit; 
            z-index: 90;
            border-bottom: 1px solid rgba(128,128,128,0.1);
        }
        
        .search-input-wrapper { 
            display: flex; 
            align-items: center; 
            background: rgba(128,128,128,0.15); 
            border-radius: 14px; 
            padding: 6px 16px;
            border: 2px solid transparent;
            transition: border 0.3s;
        }
        
        .search-input-wrapper:focus-within { 
            border-color: var(--primary); 
            background: transparent; 
        }
        
        .search-input-wrapper input { 
            flex: 1; 
            border: none; 
            background: none; 
            padding: 12px 8px; 
            color: inherit; 
            font-size: 1rem; 
            outline: none; 
        }
    </style>
</head>

<body data-theme="dark">
    <!-- Disclaimer Modal - Must be first -->
    <div id="disclaimerModal" class="disclaimer-modal">
        <div class="disclaimer-content">
            <div class="disclaimer-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h2>महत्वपूर्ण सूचना / Important Notice</h2>
            <div class="disclaimer-text">
                <p><strong>यो एउटा शैक्षिक उद्देश्यको लागि बनाइएको एप्लिकेसन हो ।</strong></p>
                <p>This is an application created for educational purposes only.</p>
                
                <p><strong>हामी कुनै पनि सरकारी निकाय, अड्डा वा सरकारी संस्थाको प्रतिनिधित्व गर्दैनौं ।</strong></p>
                <p>We are not any representation of government agency, office or governmental organization.</p>
                
                <p><strong>हामी नेपाल कानून आयोग (नेपाल ल कमिशन) को आधिकारिक वेबसाइटबाट सार्वजनिक रूपमा उपलब्ध जानकारी मात्र प्रदान गर्दछौं ।</strong></p>
                <p>We are only providing information that is publicly available from the official website of Nepal Law Commission.</p>
                
                <p><strong>कानूनी सल्लाहको लागि सदैव आधिकारिक स्रोत वा कानूनी विशेषज्ञसँग सम्पर्क गर्नुहोस् ।</strong></p>
                <p>For legal advice, always consult official sources or legal experts.</p>
            </div>
            <button id="acceptDisclaimer" class="disclaimer-btn">
                <i class="fas fa-check-circle"></i> मैले बुझेँ / I Understand
            </button>
        </div>
    </div>

    <!-- Main App Container (hidden by default) -->
    <div id="app" style="display: none;">
        <header class="app-header">
            <button class="header-btn" id="backBtn" style="visibility: hidden;">
                <i class="fas fa-chevron-left"></i>
            </button>
            <h1 class="header-title" id="mainTitle">नेपाल कानून</h1>
            <div class="header-actions">
                <button class="header-btn" id="bookmarkViewTrigger" title="Bookmarks"><i class="fas fa-bookmark"></i></button>
                <button class="header-btn" id="searchTrigger" title="Search"><i class="fas fa-search"></i></button>
                <button class="header-btn" id="settingsTrigger" title="Settings"><i class="fas fa-cog"></i></button>
            </div>
        </header>

        <main id="appContent">
            <!-- Home Screen -->
            <div id="homeScreen" class="screen active">
                <div class="hero-section">
                    <h2 id="heroTitle" style="font-size: 1.5rem; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">नेपालको संविधान २०७२</h2>
                </div>
                <div class="recycler-view" id="mainLawList"></div>
            </div>

            <!-- Detail Screen -->
            <div id="detailScreen" class="screen">
                <div id="detailContainer"></div>
            </div>

            <!-- Search Screen -->
            <div id="searchScreen" class="screen">
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <i class="fas fa-search" style="opacity: 0.5;"></i>
                        <input type="text" id="searchInput" placeholder="खोज्नुहोस् (धारा वा शीर्षक)...">
                    </div>
                </div>
                <div class="recycler-view" id="searchResults"></div>
            </div>

            <!-- Bookmarks Screen -->
            <div id="bookmarkScreen" class="screen">
                <div class="recycler-view" id="bookmarkResults"></div>
            </div>
        </main>

        <!-- Settings Modal -->
        <div class="settings-overlay" id="settingsOverlay">
            <div class="settings-panel">
                <div class="settings-section">
                    <h4>भाषा / Language</h4>
                    <div class="flex-row">
                        <button class="btn lang-btn" data-lang="nepali">नेपाली</button>
                        <button class="btn lang-btn" data-lang="english">English</button>
                    </div>
                </div>

                <div class="settings-section">
                    <h4>थीम / Mode</h4>
                    <div class="flex-row">
                        <button class="btn theme-btn" data-theme="dark">Dark</button>
                        <button class="btn theme-btn" data-theme="light">Light</button>
                    </div>
                </div>

                <div class="settings-section">
                    <h4>अक्षरको आकार / Font: <span id="fontVal">16</span>px</h4>
                    <input type="range" min="14" max="28" value="16" class="font-slider" id="fontSlider">
                </div>
                
                <button class="btn" id="closeSettings" style="width: 100%; background: var(--primary); color: white;">बन्द गर्नुहोस्</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        const appState = {
            lang: localStorage.getItem('nepal_law_lang') || 'nepali',
            theme: localStorage.getItem('nepal_law_theme') || 'dark',
            fontSize: parseInt(localStorage.getItem('nepal_law_font')) || 16,
            disclaimerAccepted: localStorage.getItem('nepal_law_disclaimer_accepted') === 'true',
            data: [],
            currentView: 'home',
            bookmarks: JSON.parse(localStorage.getItem('nepal_law_bookmarks') || '[]')
        };

        // Cached DOM elements
        let dom = {};

        // Check disclaimer status and initialize
        document.addEventListener('DOMContentLoaded', function() {
            const disclaimerModal = document.getElementById('disclaimerModal');
            const acceptBtn = document.getElementById('acceptDisclaimer');
            const mainApp = document.getElementById('app');

            // If disclaimer already accepted, show app immediately
            if (appState.disclaimerAccepted) {
                disclaimerModal.style.display = 'none';
                mainApp.style.display = 'block';
                initializeApp();
                return;
            }

            // Show disclaimer modal
            disclaimerModal.style.display = 'flex';

            // Set up accept button
            acceptBtn.onclick = function() {
                localStorage.setItem('nepal_law_disclaimer_accepted', 'true');
                appState.disclaimerAccepted = true;
                
                // Hide disclaimer with animation
                disclaimerModal.classList.add('hidden');
                
                // Show app after animation
                setTimeout(() => {
                    disclaimerModal.style.display = 'none';
                    mainApp.style.display = 'block';
                    initializeApp();
                }, 300);
            };
        });

        const initializeDOM = () => {
            dom = {
                mainLawList: document.getElementById('mainLawList'),
                homeScreen: document.getElementById('homeScreen'),
                detailScreen: document.getElementById('detailScreen'),
                searchScreen: document.getElementById('searchScreen'),
                bookmarkScreen: document.getElementById('bookmarkScreen'),
                detailContainer: document.getElementById('detailContainer'),
                searchResults: document.getElementById('searchResults'),
                bookmarkResults: document.getElementById('bookmarkResults'),
                backBtn: document.getElementById('backBtn'),
                mainTitle: document.getElementById('mainTitle'),
                settingsOverlay: document.getElementById('settingsOverlay'),
                searchInput: document.getElementById('searchInput'),
                fontSlider: document.getElementById('fontSlider'),
                fontVal: document.getElementById('fontVal'),
                searchTrigger: document.getElementById('searchTrigger'),
                bookmarkViewTrigger: document.getElementById('bookmarkViewTrigger'),
                settingsTrigger: document.getElementById('settingsTrigger'),
                closeSettings: document.getElementById('closeSettings')
            };
        };

        // Navigation Structure
        const structuredList = [
            { id: 0, nepali: "प्रस्तावना", english: "Preamble" },
            { id: 1, nepali: "भाग–१: प्रारम्भिक", english: "Part-1: Preliminary" },
            { id: 2, nepali: "भाग–२: नागरिकता", english: "Part-2: Citizenship" },
            { id: 3, nepali: "भाग–३: मौलिक हक र कर्तव्य", english: "Part-3: Fundamental Rights and Duties" },
            { id: 4, nepali: "भाग–४: राज्यका निर्देशक सिद्धान्त, नीति तथा दायित्व", english: "Part-4: Directive Principles, Policies and Obligations of the State" },
            { id: 5, nepali: "भाग–५: राज्यको संरचना र राज्यशक्तिको बाँडफाँट", english: "Part-5: Structure of State and Distribution of State Power" },
            { id: 6, nepali: "भाग–६: राष्ट्रपति र उपराष्ट्रपति", english: "Part-6: President and Vice-President" },
            { id: 7, nepali: "भाग–७: सङ्घीय कार्यपालिका", english: "Part-7: Federal Executive" },
            { id: 8, nepali: "भाग–८: सङ्घीय व्यवस्थापिका", english: "Part-8: Federal Legislature" },
            { id: 9, nepali: "भाग–९: सङ्घीय व्यवस्थापिकीय कार्यविधि", english: "Part-9: Federal Legislative Procedures" },
            { id: 10, nepali: "भाग–१०: सङ्घीय आर्थिक कार्य प्रणाली", english: "Part-10: Federal Financial Procedures" },
            { id: 11, nepali: "भाग–११: न्यायपालिका", english: "Part-11: Judiciary" },
            { id: 12, nepali: "भाग–१२: महान्यायाधिवक्ता", english: "Part-12: Attorney General" },
            { id: 13, nepali: "भाग–१३: प्रदेश कार्यपालिका", english: "Part-13: State Executive" },
            { id: 14, nepali: "भाग–१४: प्रदेश व्यवस्थापिका", english: "Part-14: State Legislature" },
            { id: 15, nepali: "भाग–१५: प्रदेश व्यवस्थापिकीय कार्यविधि", english: "Part-15: State Legislative Procedures" },
            { id: 16, nepali: "भाग–१६: प्रदेश आर्थिक कार्य प्रणाली", english: "Part-16: State Financial Procedures" },
            { id: 17, nepali: "भाग–१७: स्थानीय कार्यपालिका", english: "Part-17: Local Executive" },
            { id: 18, nepali: "भाग–१८: स्थानीय व्यवस्थापिका", english: "Part-18: Local Legislature" },
            { id: 19, nepali: "भाग–१९: स्थानीय आर्थिक कार्य प्रणाली", english: "Part-19: Local Financial Procedures" },
            { id: 20, nepali: "भाग–२०: सङ्घ, प्रदेश र स्थानीय तह बीच अन्तरसम्बन्ध", english: "Part-20: Interrelations" },
            { id: 21, nepali: "भाग–२१: अख्तियार दुरुपयोग अनुसन्धान आयोग", english: "Part-21: CIAA" },
            { id: 22, nepali: "भाग–२२: महालेखा परीक्षक", english: "Part-22: Auditor General" },
            { id: 23, nepali: "भाग–२३: लोक सेवा आयोग", english: "Part-23: Public Service Commission" },
            { id: 24, nepali: "भाग–२४: निर्वाचन आयोग", english: "Part-24: Election Commission" },
            { id: 25, nepali: "भाग–२५: राष्ट्रिय मानव अधिकार आयोग", english: "Part-25: NHRC" },
            { id: 26, nepali: "भाग–२६: राष्ट्रिय प्राकृतिक स्रोत तथा वित्तीय आयोग", english: "Part-26: NRFC" },
            { id: 27, nepali: "भाग–२७: अन्य आयोगहरू", english: "Part-27: Other Commissions" },
            { id: 28, nepali: "भाग–२८: राष्ट्रिय सुरक्षा सम्बन्धी व्यवस्था", english: "Part-28: National Security" },
            { id: 29, nepali: "भाग–२९: राजनीतिक दल सम्बन्धी व्यवस्था", english: "Part-29: Political Parties" },
            { id: 30, nepali: "भाग–३०: सङ्कटकालीन अधिकार", english: "Part-30: Emergency Powers" },
            { id: 31, nepali: "भाग–३१: संविधान संशोधन", english: "Part-31: Amendment" },
            { id: 32, nepali: "भाग–३२: विविध", english: "Part-32: Miscellaneous" },
            { id: 33, nepali: "भाग–३३: सङ्क्रमणकालीन व्यवस्था", english: "Part-33: Transitional Provisions" },
            { id: 34, nepali: "भाग–३४: परिभाषा र व्याख्या", english: "Part-34: Definitions" },
            { id: 35, nepali: "भाग–३५: संक्षिप्त नाम, प्रारम्भ र खारेजी", english: "Part-35: Short Title" },
            { id: 1001, nepali: "अनुसूची-१: राष्ट्रिय झण्डा", english: "Schedule-1: National Flag" },
            { id: 1002, nepali: "अनुसूची-२: राष्ट्रिय गान", english: "Schedule-2: National Anthem" },
            { id: 1003, nepali: "अनुसूची-३: निशान छाप", english: "Schedule-3: Coat of Arms" },
            { id: 1004, nepali: "अनुसूची-४: प्रदेश र जिल्लाहरू", english: "Schedule-4: Provinces" },
            { id: 1005, nepali: "अनुसूची-५: संघको अधिकार", english: "Schedule-5: Federal Power" },
            { id: 1006, nepali: "अनुसूची-६: प्रदेशको अधिकार", english: "Schedule-6: Provincial Power" },
            { id: 1007, nepali: "अनुसूची-७: साझा अधिकार (संघ र प्रदेश)", english: "Schedule-7: Concurrent Power" },
            { id: 1008, nepali: "अनुसूची-८: स्थानीय तहको अधिकार", english: "Schedule-8: Local Power" },
            { id: 1009, nepali: "अनुसूची-९: साझा अधिकार (संघ, प्रदेश र स्थानीय)", english: "Schedule-9: Joint Power" }
        ];

        async function loadData() {
            try {
                const response = await fetch('backend/data/laws.json');
                const json = await response.json();
                appState.data = json.detailList;
                applySettings();
                renderMainList();
            } catch (err) {
                console.error("Data Load Error:", err);
            }
        }            

        function animateItems(containerSelector) {
            const items = document.querySelectorAll(`${containerSelector} .law-item`);
            items.forEach((item, index) => {
                item.style.animationDelay = `${index * 0.05}s`;
                item.classList.add('animate-in');
            });
        }

        function renderMainList() {
            if (!dom.mainLawList) return;
            dom.mainLawList.innerHTML = '';
            structuredList.forEach(item => {
                const div = document.createElement('div');
                div.className = 'law-item';
                const title = appState.lang === 'nepali' ? item.nepali : item.english;
                const displayId = item.id > 1000 ? (item.id - 1000) : item.id;
                const prefix = appState.lang === 'nepali' ? (item.id > 1000 ? 'अ' : 'भ') : (item.id > 1000 ? 'S' : 'P');
                
                div.innerHTML = `
                    <div class="item-icon">${item.id === 0 ? '<i class="fas fa-scroll"></i>' : prefix + displayId}</div>
                    <div class="item-info"><h3>${title}</h3></div>
                `;
                div.onclick = () => showDetail(item.id);
                dom.mainLawList.appendChild(div);
            });
            animateItems('#mainLawList');
        }

        function showDetail(id) {
            const section = appState.data.find(d => d.id === id);
            if (!section) return;

            changeView('detail');
            const headerInfo = structuredList.find(s => s.id === id);
            dom.mainTitle.innerText = appState.lang === 'nepali' ? headerInfo.nepali : headerInfo.english;

            dom.detailContainer.innerHTML = '';
            section.list.forEach((article, index) => {
                const card = createLawCard(article, headerInfo, id, index);
                dom.detailContainer.appendChild(card);
            });
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function createLawCard(article, sectionInfo, sectionId, index) {
            const card = document.createElement('div');
            card.className = 'content-card';
            card.style.animation = `fadeInUp 0.5s ease-out forwards`;
            card.style.animationDelay = `${index * 0.1}s`;
            card.style.opacity = 0;
            
            const title = appState.lang === 'nepali' ? article.title : (article.englishTitle || article.title);
            const desc = appState.lang === 'nepali' ? article.description : (article.englishDescription || article.description);
            
            const bookmarkKey = `${sectionId}-${index}`;
            const isBookmarked = appState.bookmarks.includes(bookmarkKey);

            card.innerHTML = `
                <div class="card-header">
                    <h3 style="color: var(--primary); margin:0; font-size: 1.1rem;">${title}</h3>
                    <i class="${isBookmarked ? 'fas' : 'far'} fa-bookmark bookmark-icon" data-key="${bookmarkKey}"></i>
                </div>
                <p style="margin: 10px 0 0 0;">${desc.replace(/\n/g, '<br>')}</p>
            `;

            card.querySelector('.bookmark-icon').onclick = (e) => {
                toggleBookmark(bookmarkKey, e.target);
            };

            return card;
        }

        function toggleBookmark(key, element) {
            const idx = appState.bookmarks.indexOf(key);
            if (idx > -1) {
                appState.bookmarks.splice(idx, 1);
                element.classList.replace('fas', 'far');
            } else {
                appState.bookmarks.push(key);
                element.classList.replace('far', 'fas');
            }
            localStorage.setItem('nepal_law_bookmarks', JSON.stringify(appState.bookmarks));
        }

        function setupSearch() {
            if (!dom.searchInput) return;
            dom.searchInput.oninput = (e) => {
                const query = e.target.value.toLowerCase().trim();
                dom.searchResults.innerHTML = '';
                if (!query) return;

                let count = 0;
                appState.data.forEach(section => {
                    const sectionMeta = structuredList.find(s => s.id === section.id);
                    section.list.forEach((article, index) => {
                        if (count > 40) return;
                        const text = (article.title + article.description + (article.englishTitle||'') + (article.englishDescription||'')).toLowerCase();
                        
                        if (text.includes(query)) {
                            count++;
                            const div = document.createElement('div');
                            div.className = 'law-item animate-in';
                            const metaText = appState.lang === 'nepali' ? sectionMeta.nepali : sectionMeta.english;
                            div.innerHTML = `
                                <div class="item-info">
                                    <div style="font-size: 0.75rem; color: var(--primary); font-weight:bold;">${metaText}</div>
                                    <h3>${appState.lang === 'nepali' ? article.title : (article.englishTitle || article.title)}</h3>
                                </div>
                            `;
                            div.onclick = () => showDetail(section.id);
                            dom.searchResults.appendChild(div);
                        }
                    });
                });
            };
        }

        function renderBookmarks() {
            if (!dom.bookmarkResults) return;
            dom.bookmarkResults.innerHTML = '';
            if (appState.bookmarks.length === 0) {
                dom.bookmarkResults.innerHTML = `<div style="text-align:center; padding:100px 20px; opacity:0.5;">
                    <i class="far fa-bookmark" style="font-size: 3rem; margin-bottom: 15px;"></i><br>कुनै बुकमार्क भेटिएन।
                </div>`;
                return;
            }

            appState.bookmarks.forEach(key => {
                const [sId, aIdx] = key.split('-').map(Number);
                const section = appState.data.find(d => d.id === sId);
                const sectionMeta = structuredList.find(s => s.id === sId);
                if (section && section.list[aIdx]) {
                    const article = section.list[aIdx];
                    const div = document.createElement('div');
                    div.className = 'law-item animate-in';
                    div.innerHTML = `
                        <div class="item-info">
                            <div style="font-size: 0.75rem; color: var(--primary); font-weight:bold;">${appState.lang === 'nepali' ? sectionMeta.nepali : sectionMeta.english}</div>
                            <h3>${appState.lang === 'nepali' ? article.title : (article.englishTitle || article.title)}</h3>
                        </div>
                    `;
                    div.onclick = () => showDetail(sId);
                    dom.bookmarkResults.appendChild(div);
                }
            });
        }

        function changeView(view) {
            appState.currentView = view;
            const screens = [dom.homeScreen, dom.detailScreen, dom.searchScreen, dom.bookmarkScreen];
            screens.forEach(s => { if(s) s.classList.remove('active'); });
            
            if (dom.backBtn) dom.backBtn.style.visibility = view === 'home' ? 'hidden' : 'visible';
            
            if (view === 'home' && dom.homeScreen) {
                dom.homeScreen.classList.add('active');
                dom.mainTitle.innerText = appState.lang === 'nepali' ? 'नेपाल कानून' : 'Nepal Law';
                renderMainList();
            } else if (view === 'detail' && dom.detailScreen) {
                dom.detailScreen.classList.add('active');
            } else if (view === 'search' && dom.searchScreen) {
                dom.searchScreen.classList.add('active');
                dom.mainTitle.innerText = appState.lang === 'nepali' ? 'खोज्नुहोस्' : 'Search';
                dom.searchInput.focus();
            } else if (view === 'bookmark' && dom.bookmarkScreen) {
                dom.bookmarkScreen.classList.add('active');
                dom.mainTitle.innerText = appState.lang === 'nepali' ? 'बुकमार्कहरू' : 'Bookmarks';
                renderBookmarks();
            }
            window.scrollTo(0, 0);
        }

        function applySettings() {
            document.body.setAttribute('data-theme', appState.theme);
            document.documentElement.style.setProperty('--font-size', appState.fontSize + 'px');
            if(dom.fontVal) dom.fontVal.innerText = appState.fontSize;
            if(dom.fontSlider) dom.fontSlider.value = appState.fontSize;

            document.querySelectorAll('.lang-btn').forEach(b => b.classList.toggle('active', b.dataset.lang === appState.lang));
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.toggle('active', b.dataset.theme === appState.theme));
            
            const hero = document.getElementById('heroTitle');
            if (hero) hero.innerText = appState.lang === 'nepali' ? 'नेपालको संविधान २०७२' : 'Constitution of Nepal 2015';
            if (dom.searchInput) dom.searchInput.placeholder = appState.lang === 'nepali' ? 'खोज्नुहोस् (धारा वा शीर्षक)...' : 'Search (Article or Title)...';
        }

        const setupEventListeners = () => {
            if (dom.backBtn) dom.backBtn.onclick = () => changeView('home');
            if (dom.searchTrigger) dom.searchTrigger.onclick = () => changeView('search');
            if (dom.bookmarkViewTrigger) dom.bookmarkViewTrigger.onclick = () => changeView('bookmark');
            
            if (dom.settingsTrigger) {
                dom.settingsTrigger.onclick = () => {
                    dom.settingsOverlay.style.display = 'flex';
                    setTimeout(() => dom.settingsOverlay.classList.add('open'), 10);
                };
            }

            const closeSettings = () => {
                dom.settingsOverlay.classList.remove('open');
                setTimeout(() => dom.settingsOverlay.style.display = 'none', 300);
            };

            if (dom.closeSettings) dom.closeSettings.onclick = closeSettings;
            if (dom.settingsOverlay) {
                dom.settingsOverlay.onclick = (e) => { if(e.target === dom.settingsOverlay) closeSettings(); };
            }

            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.onclick = () => {
                    appState.lang = btn.dataset.lang;
                    localStorage.setItem('nepal_law_lang', appState.lang);
                    applySettings();
                    if(appState.currentView === 'home') renderMainList();
                    else changeView(appState.currentView);
                };
            });

            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.onclick = () => {
                    appState.theme = btn.dataset.theme;
                    localStorage.setItem('nepal_law_theme', appState.theme);
                    applySettings();
                };
            });

            if (dom.fontSlider) {
                dom.fontSlider.oninput = (e) => {
                    appState.fontSize = e.target.value;
                    localStorage.setItem('nepal_law_font', appState.fontSize);
                    applySettings();
                };
            }

            setupSearch();
        };

        function initializeApp() {
            initializeDOM();
            setupEventListeners();
            loadData();
            applySettings();
        }
    </script>
</body>
</html>